#!/bin/bash

# Utilisateur courant
CURRENT_USER=$(whoami)

# Demande du nouveau mot de passe (Zenity)
NEW_PASS=$(zenity --password --title="Définir votre nouveau mot de passe")
[ -z "$NEW_PASS" ] && exit 1

CONFIRM_PASS=$(zenity --password --title="Confirmer votre mot de passe")
[ -z "$CONFIRM_PASS" ] && exit 1

if [ "$NEW_PASS" != "$CONFIRM_PASS" ]; then
    zenity --error --text="Les mots de passe ne correspondent pas."
    exit 1
fi

# Changement de mot de passe sans demander l'ancien
echo "$CURRENT_USER:$NEW_PASS" | sudo /usr/sbin/chpasswd

# Confirmation
zenity --info --text="Votre mot de passe a été changé avec succès."

# Auto-suppression après exécution (optionnel)
rm -- "$0"